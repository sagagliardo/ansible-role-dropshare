machine:
  python:
    version: 2.7
  environment:
    TF_VAR_build_num: ${CIRCLE_BUILD_NUM}

dependencies:
  cache_directories:
    - "~/bin"
  pre:
    - pip install pyyaml jinja2 testinfra ansible==2.2.1.0
    - mkdir -p ~/bin
    - ./circle/deps.sh
    - ansible-galaxy install -p "~/bin/roles" naftulikay.degoss

test:
  pre:
    - terraform plan circle/terraform
    - terraform apply circle/terraform
  post:
    - terraform destroy -force circle/terraform
